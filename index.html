<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Circle vs Star — 1.0版本</title>
<style>
  body,html{
    margin:0;height:100%;background:#000;
    display:flex;flex-direction:column;align-items:center;
    font-family:sans-serif;
  }
  canvas{background:#222;touch-action:none;max-width:100%}
  #controls{
    margin:6px;display:flex;gap:10px;flex-wrap:wrap;
    align-items:flex-start;justify-content:center;color:#fff
  }
  .cfg{background:#111;padding:6px 10px;border-radius:8px}
  label{font-size:12px;display:block;margin-top:2px}
  input[type=number]{font-size:12px;width:80px}
  button{padding:6px 12px;margin-top:8px}
  #popup{
    position:fixed;top:0;left:0;width:100%;height:100%;
    background:rgba(0,0,0,0.85);display:none;
    align-items:center;justify-content:center;z-index:999;
  }
  #popup img{max-width:90%;max-height:90%;border-radius:12px}
  #bottomText {
  position: fixed;
  bottom: 50px;
  width: 400%;
  text-align: center;
  color: #fff;
  font-size: 50px;
  font-family: sans-serif;
  pointer-events: none;
  z-index: 1000;
}
</style>
</head>
<body>
<div id="controls">
  <!-- 判定框输入隐藏 -->
  <div class="cfg" style="display:none;">
    <label>X (%)</label><input type="number" id="zoneX" value="45" min="0" max="100">
    <label>Y (%)</label><input type="number" id="zoneY" value="57" min="0" max="100">
    <label>宽 (%)</label><input type="number" id="zoneW" value="10" min="5" max="100">
    <label>高 (%)</label><input type="number" id="zoneH" value="4" min="4" max="100">
  </div>
  <!-- 隐藏重玩按钮 -->
  <button id="restart" style="display:none;">重玩</button>
</div>

<canvas id="c"></canvas>
<div id="popup"><img id="popupImg"></div>
<!-- 底部文字 -->
<div id="bottomText">该贴哪个呢？</div>

<script>
const canvas=document.getElementById('c');
const ctx=canvas.getContext('2d');
let W,H;

// 保持竖屏 9:16 比例
function resize(){
  const ratio = 16/9;
  let w = window.innerWidth * 0.9;
  let h = w * ratio;
  if(h > window.innerHeight * 0.9){
    h = window.innerHeight * 0.9;
    w = h / ratio;
  }
  W=Math.floor(w);
  H=Math.floor(h);
  canvas.width=W;
  canvas.height=H;
}
resize();
window.addEventListener('resize',resize);

// === 素材 ===
const bgImg=new Image();
const circleImg=new Image();
const starImg=new Image();
const endCircleImg=new Image();
const endStarImg=new Image();

// 固定图片路径
bgImg.src = "images/bg.jpg";       // 背景  
circleImg.src = "images/circle.png";  // 圆图
starImg.src = "images/star.png";      // 星图
endCircleImg.src = "images/guizi.jpg"; // 圆结束图
endStarImg.src = "images/hero.jpg";     // 星结束图
// 游戏变量
let shapes=[],running=false;
let spawnTimer=0,spawnInterval=1.2,speed=200;

// 判定区间
function getZone(){
  const xPct=parseFloat(document.getElementById('zoneX').value)/100;
  const yPct=parseFloat(document.getElementById('zoneY').value)/100;
  const wPct=parseFloat(document.getElementById('zoneW').value)/100;
  const hPct=parseFloat(document.getElementById('zoneH').value)/100;
  return {x:W*xPct,y:H*yPct,w:W*wPct,h:H*hPct};
}

// 生成图形
function spawn(){
  const type=Math.random()<0.5?"circle":"star";
  const z=getZone();
  const y=z.y+z.h/2;
  shapes.push({x:-60,y,type,size:W*0.12});
}

// 更新逻辑
function update(dt){
  spawnTimer-=dt;
  if(spawnTimer<=0){
    spawn();
    spawnTimer=spawnInterval;
  }
  for(const s of shapes){s.x+=speed*dt;}
  shapes=shapes.filter(s=>s.x<W+100);
}

// 绘制
function draw(){
  ctx.clearRect(0,0,W,H);
  if(bgImg.complete)ctx.drawImage(bgImg,0,0,W,H);
  else{ctx.fillStyle="#444";ctx.fillRect(0,0,W,H);}
  // 判定区
  const z=getZone();
  ctx.strokeStyle="rgba(255,255,255,0.6)";
  ctx.lineWidth=2;
  ctx.strokeRect(z.x,z.y,z.w,z.h);
  // 图形
  for(const s of shapes){
    const img=(s.type==="circle")?circleImg:starImg;
    if(img.complete)ctx.drawImage(img,s.x-s.size/2,s.y-s.size/2,s.size,s.size);
    else{
      ctx.fillStyle=s.type==="circle"?"#0f0":"#f00";
      ctx.beginPath();
      ctx.arc(s.x,s.y,s.size/2,0,Math.PI*2);
      ctx.fill();
    }
  }
}

// 点击判定（点击即结束）
function handleClick(){
  if(!running)return;
  const z=getZone();
  const inside=shapes.filter(s=>
    s.x>=z.x && s.x<=z.x+z.w &&
    s.y>=z.y && s.y<=z.y+z.h
  );
  if(inside.length>0){
    const target=inside[0];
    if(target.type==="circle"){
      showPopup(endCircleImg);
    }else{
      showPopup(endStarImg);
    }
    running=false;
  }
}


// 弹窗显示结束图
function showPopup(img){
  const popup=document.getElementById('popup');
  const popupImg=document.getElementById('popupImg');
  popupImg.src=img.src;
  popup.style.display="flex";
  
  // 点击结束图后重启
  popupImg.addEventListener('click', () => {
    restart();
  });
}

function restart(){
  shapes=[];running=true;
  document.getElementById('popup').style.display="none";
};

// 循环
let last=0;
function loop(ts){
  if(!last)last=ts;
  const dt=(ts-last)/1000;
  last=ts;
  if(running)update(dt);
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

// 控制
canvas.addEventListener('pointerdown',handleClick);
document.getElementById('restart').onclick=()=>restart();
running=true;
</script>
</body>
</html>


